<!DOCTYPE html>
<html lang="id">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>QR Code Resi Generator</title>
    <!-- Load Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Load jQuery -->
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <!-- Load QR Code Generator Library -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/qrcodejs/1.0.0/qrcode.min.js"></script>
    <!-- Load Firebase/Firestore for environment compatibility (Minimal setup) -->
    <script type="module">
      import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
      import {
        getAuth,
        signInAnonymously,
        signInWithCustomToken,
      } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";
      import { getFirestore } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";
      import { setLogLevel } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";

      // Global variables provided by the environment
      const firebaseConfig =
        typeof __firebase_config !== "undefined"
          ? JSON.parse(__firebase_config)
          : null;
      const initialAuthToken =
        typeof __initial_auth_token !== "undefined"
          ? __initial_auth_token
          : null;

      // Function to initialize Firebase and authenticate (minimal setup for environment)
      async function initializeFirebase() {
        if (!firebaseConfig) {
          console.error("Firebase configuration is missing.");
          return;
        }

        try {
          const app = initializeApp(firebaseConfig);
          const auth = getAuth(app);
          const db = getFirestore(app);

          // Set logging level for debugging
          setLogLevel("Debug");

          if (initialAuthToken) {
            await signInWithCustomToken(auth, initialAuthToken);
          } else {
            await signInAnonymously(auth);
          }
          console.log("Firebase Authentication successful (minimal setup).");
        } catch (error) {
          console.error(
            "Error during Firebase initialization or authentication:",
            error
          );
        }
      }

      // Run initialization
      initializeFirebase();
    </script>
    <style>
      /* Style untuk memastikan QR Code terlihat tajam dan ukurannya pas */
      #qrcode-canvas canvas {
        display: block; /* Menghilangkan margin bawah default pada canvas */
      }

      .instruction-icon {
        animation: pulse-orange 2s infinite cubic-bezier(0.4, 0, 0.6, 1);
      }

      @keyframes pulse-orange {
        0%,
        100% {
          opacity: 1;
        }
        50% {
          opacity: 0.5;
        }
      }
    </style>
  </head>
  <!-- Menggunakan font Inter secara default karena didukung Tailwind -->
  <body class="bg-orange-600 min-h-screen font-sans antialiased">
    <!-- BACKGROUND ORANGE -->

    <div class="container mx-auto p-4 sm:p-6 lg:p-8 relative">
      <!-- START: HEADER MODIFIED FOR TWO COLUMNS -->
      <header class="mb-10 p-0 sm:p-4 max-w-6xl mx-auto">
        <!-- Menggunakan Flexbox untuk dua kolom di desktop, dan stack di mobile secara default -->
        <div class="md:flex md:justify-between md:items-center">
          <!-- Kolom 1: Konten Utama (Judul dan Deskripsi) - Rata Kiri di Desktop -->
          <div class="text-left mb-6 md:mb-0">
            <!-- PENYESUAIAN FONT SIZE RESPONSIVE -->
            <h1
              class="text-3xl sm:text-4xl lg:text-5xl font-extrabold text-white"
            >
              QR Code Resi Generator
            </h1>
            <p class="text-base sm:text-lg text-orange-100 mt-2">
              Masukkan beberapa nomor resi untuk membuat Kode QR secara instan.
            </p>
          </div>

          <!-- Kolom 2: Identitas "andiwinar" - Rata Kanan di Desktop -->
          <div class="text-right flex justify-end items-center">
            <div
              class="p-3 border-2 border-orange-400 bg-orange-700/50 backdrop-blur-sm rounded-xl shadow-xl transition hover:bg-orange-700/70"
            >
              <a
                href="https://www.linkedin.com/in/andiwinar/"
                target="_blank"
                class="text-xl sm:text-2xl lg:text-3xl font-mono tracking-wider text-white hover:text-orange-300 transition duration-300 font-bold"
              >
                andiwinar
              </a>
              <p class="text-xs text-orange-200 mt-1 font-medium">Developer</p>
            </div>
          </div>
        </div>
      </header>
      <!-- END: HEADER MODIFIED FOR TWO COLUMNS -->

      <!-- START: Layout Wrapper for Desktop (lg:flex) -->
      <div class="max-w-6xl mx-auto lg:flex lg:space-x-8 lg:items-start">
        <!-- Input Section (Left side on desktop) -->
        <div
          id="input-section"
          class="bg-white p-6 md:p-8 rounded-xl shadow-2xl mb-10 w-full lg:w-1/2"
        >
          <h2 class="text-2xl font-semibold text-gray-800 mb-4">Input Resi</h2>
          <textarea
            id="resi-input"
            rows="10"
            class="w-full p-4 border-2 border-orange-300 rounded-lg focus:ring-orange-500 focus:border-orange-500 transition duration-150 text-gray-700 placeholder-gray-400"
            placeholder="Masukkan nomor resi, pisahkan dengan baris baru (Enter) atau koma.&#10;Contoh:&#10;JKT123456789&#10;SBY987654321&#10;BDG112233445"
          ></textarea>

          <!-- BUTTON WARNA ORANGE SHOPEE -->
          <button
            id="generate-btn"
            class="mt-4 w-full bg-orange-700 hover:bg-orange-800 text-white font-bold py-3 px-4 rounded-xl shadow-lg transition duration-300 ease-in-out transform hover:scale-[1.01] focus:outline-none focus:ring-4 focus:ring-orange-500 focus:ring-opacity-50"
          >
            Generate QR Code
          </button>

          <!-- TOMBOL DOWNLOAD SEMUA RESI -->
          <button
            id="download-all-btn"
            class="mt-3 w-full flex items-center justify-center bg-gray-600 hover:bg-gray-700 text-white font-bold py-3 px-4 rounded-xl shadow-lg transition duration-300 ease-in-out hidden transform hover:scale-[1.01] focus:outline-none focus:ring-4 focus:ring-gray-500 focus:ring-opacity-50"
          >
            <!-- Download Icon -->
            <svg
              class="w-5 h-5 mr-2"
              fill="none"
              stroke="currentColor"
              viewBox="0 0 24 24"
              xmlns="http://www.w3.org/2000/svg"
            >
              <path
                stroke-linecap="round"
                stroke-linejoin="round"
                stroke-width="2"
                d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4"
              ></path>
            </svg>
            Unduh Resi (.csv)
          </button>

          <!-- PESAN ERROR INLINE DIHILANGKAN, DIGANTI MODAL -->
        </div>

        <!-- Output Section (Right side on desktop) -->
        <div id="output-section" class="mt-10 lg:mt-0 w-full lg:w-1/2">
          <!-- Modifikasi Title: Tambahkan ID dan ubah teks default ke Instruksi -->
          <h2
            id="output-title-h2"
            class="text-3xl font-bold text-white mb-6 text-center"
          >
            Instruksi
          </h2>

          <!-- Wrapper for the single card and navigation buttons -->
          <div
            id="navigation-wrapper"
            class="relative py-0 flex items-center justify-center min-h-[300px]"
          >
            <!-- Navigation Buttons (Sekarang selalu ada di DOM, tapi disembunyikan/dinonaktifkan jika perlu) -->
            <button
              id="prev-btn"
              disabled
              class="nav-button absolute left-0 z-10 p-3 bg-white rounded-full shadow-xl transition duration-150 top-1/2 -translate-y-1/2 disabled:opacity-30 disabled:cursor-not-allowed hidden lg:left-[-1.5rem]"
            >
              <!-- Icon Previous -->
              <svg
                class="w-6 h-6 text-orange-600"
                fill="none"
                stroke="currentColor"
                viewBox="0 0 24 24"
                xmlns="http://www.w3.org/2000/svg"
              >
                <path
                  stroke-linecap="round"
                  stroke-linejoin="round"
                  stroke-width="3"
                  d="M15 19l-7-7 7-7"
                ></path>
              </svg>
            </button>

            <!-- The single card container. -->
            <div id="single-card-wrapper" class="w-full mx-auto">
              <!-- Default Content (Instructional Card) -->
              <div
                id="default-instruction-card"
                class="bg-white p-8 rounded-xl shadow-xl transition duration-300 text-center flex flex-col items-center justify-center h-full"
              >
                <!-- Icon Ilustrasi (Ambil dari Lucide-react/SVG, di sini kita gunakan SVG sederhana) -->
                <svg
                  xmlns="http://www.w3.org/2000/svg"
                  class="w-16 h-16 text-orange-500 mb-4 instruction-icon"
                  viewBox="0 0 24 24"
                  fill="none"
                  stroke="currentColor"
                  stroke-width="2"
                  stroke-linecap="round"
                  stroke-linejoin="round"
                >
                  <rect x="2" y="3" width="20" height="18" rx="2" ry="2"></rect>
                  <line x1="8" y1="21" x2="8" y2="3"></line>
                  <line x1="16" y1="21" x2="16" y2="3"></line>
                  <line x1="2" y1="12" x2="22" y2="12"></line>
                  <path d="M6 6h.01"></path>
                  <path d="M18 18h.01"></path>
                </svg>
                <h3 class="text-xl font-bold text-gray-800 mb-2">
                  Siap untuk Membuat QR Code?
                </h3>
                <p class="text-gray-600 mb-4">
                  Bagian ini adalah tempat hasil kode QR Anda akan ditampilkan.
                </p>
                <ol
                  class="text-left text-sm text-gray-700 space-y-2 w-full max-w-[500px] mx-auto"
                >
                  <li class="flex items-center">
                    <span
                      class="bg-orange-100 text-orange-700 w-5 h-5 flex items-center justify-center rounded-full mr-2 font-semibold"
                      >1</span
                    >
                    Masukkan resi di kolom kiri.
                  </li>
                  <li class="flex items-center">
                    <span
                      class="bg-orange-100 text-orange-700 w-5 h-5 flex items-center justify-center rounded-full mr-2 font-semibold"
                      >2</span
                    >
                    Tekan tombol
                    <span class="font-semibold text-orange-700 ml-1"
                      >Generate QR Code</span
                    >.
                  </li>
                  <li class="flex items-center">
                    <span
                      class="bg-orange-100 text-orange-700 w-5 h-5 flex items-center justify-center rounded-full mr-2 font-semibold"
                      >3</span
                    >
                    Kode QR siap discan!
                  </li>
                </ol>
                <p class="text-xs text-gray-500 mt-4">
                  Coba masukkan 2-3 resi untuk melihat fitur navigasi.
                </p>
              </div>
            </div>

            <!-- Navigation Buttons (Sekarang selalu ada di DOM) -->
            <button
              id="next-btn"
              disabled
              class="nav-button absolute right-0 z-10 p-3 bg-white rounded-full shadow-xl transition duration-150 top-1/2 -translate-y-1/2 disabled:opacity-30 disabled:cursor-not-allowed hidden lg:right-[-1.5rem]"
            >
              <!-- Icon Next -->
              <svg
                class="w-6 h-6 text-orange-600"
                fill="none"
                stroke="currentColor"
                viewBox="0 0 24 24"
                xmlns="http://www.w3.org/2000/svg"
              >
                <path
                  stroke-linecap="round"
                  stroke-linejoin="round"
                  stroke-width="3"
                  d="M9 5l7 7-7 7"
                ></path>
              </svg>
            </button>
          </div>
        </div>
      </div>
      <!-- END: Layout Wrapper for Desktop (lg:flex) -->
    </div>

    <!-- START: CUSTOM ERROR MODAL (Popup) -->
    <div
      id="error-modal"
      class="fixed inset-0 bg-gray-900 bg-opacity-70 z-50 flex justify-center items-center hidden transition-opacity duration-300"
    >
      <div
        class="bg-white p-6 sm:p-8 rounded-xl shadow-2xl max-w-sm w-11/12 transform transition-transform duration-300 scale-95"
      >
        <div class="flex flex-col items-center">
          <!-- Ikon Peringatan -->
          <svg
            class="w-12 h-12 text-red-500 mb-4 animate-bounce"
            fill="none"
            stroke="currentColor"
            viewBox="0 0 24 24"
            xmlns="http://www.w3.org/2000/svg"
          >
            <path
              stroke-linecap="round"
              stroke-linejoin="round"
              stroke-width="2"
              d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"
            ></path>
          </svg>
          <h3 class="text-xl font-bold text-gray-900 mb-2">Input Kosong!</h3>
          <p id="modal-error-text" class="text-center text-gray-600 mb-6">
            Mohon masukkan setidaknya satu nomor resi yang valid pada kolom
            input.
          </p>
          <button
            id="close-modal-btn"
            class="w-full bg-orange-600 hover:bg-orange-700 text-white font-semibold py-2 rounded-lg transition duration-200 shadow-md"
          >
            Tutup
          </button>
        </div>
      </div>
    </div>
    <!-- END: CUSTOM ERROR MODAL (Popup) -->

    <script>
      // --- START IMPROVED SECURITY FEATURES ---

      // Cek apakah hostname mengandung 'github.io'
      if (document.location.hostname.includes("github.io")) {
        console.log(
          "GitHub Pages detected. Enhanced client-side security features are active."
        );

        // 1. Menonaktifkan Klik Kanan (Context Menu)
        // document.addEventListener("contextmenu", function (e) {
        //   e.preventDefault();
        //   // Opsional: Anda dapat menampilkan modal error/pesan khusus di sini jika mau
        //   // showModalError("Akses klik kanan dibatasi.");
        // });

        // 2. Menonaktifkan Shortcut Keyboard untuk Developer Tools, View Source, dan Save Page
        document.addEventListener("keydown", function (e) {
          const key = e.key.toUpperCase();
          // Cek untuk CtrlKey atau MetaKey (Command key di Mac)
          const ctrlOrCmd = e.ctrlKey || e.metaKey;
          const shift = e.shiftKey;

          // F12 key (membuka DevTools)
          if (e.key === "F12") {
            e.preventDefault();
            return;
          }

          if (ctrlOrCmd) {
            // Ctrl/Cmd + U (View Source)
            if (key === "U") {
              e.preventDefault();
              return;
            }

            // Ctrl/Cmd + S (Save Page)
            if (key === "S") {
              e.preventDefault();
              return;
            }

            // Ctrl/Cmd + Shift shortcuts (Inspect Element, Console, etc.)
            if (shift) {
              // I, J, C (Chrome DevTools)
              // K, E (Firefox DevTools/Network)
              const blockedShiftKeys = ["I", "J", "C", "K", "E"];
              if (blockedShiftKeys.includes(key)) {
                e.preventDefault();
                return;
              }
            }
          }
        });
      } else {
        console.log(
          "Not running on GitHub Pages. Security features are inactive."
        );
      }
      // --- END IMPROVED SECURITY FEATURES ---

      $(document).ready(function () {
        // --- Variabel Global dan UI Cache ---
        const $input = $("#resi-input");
        const $generateBtn = $("#generate-btn");
        const $downloadAllBtn = $("#download-all-btn");
        const $wrapper = $("#single-card-wrapper");
        const $outputTitle = $("#output-title-h2");
        const $prevBtn = $("#prev-btn");
        const $nextBtn = $("#next-btn");
        const $defaultCard = $("#default-instruction-card");

        // Modal elements
        const $errorModal = $("#error-modal");
        const $closeModalBtn = $("#close-modal-btn");
        // const $modalErrorText = $("#modal-error-text"); // Jika ingin teks dinamis

        let resiNumbers = [];
        let currentIndex = 0;
        const qrcodeId = "qrcode-canvas";

        // Fungsi baru untuk menampilkan modal error
        function showModalError(message) {
          // Set teks pesan (jika dinamis, gunakan $modalErrorText.text(message))
          // Saat ini teks sudah statis di HTML, jadi hanya perlu menampilkan/menyembunyikan
          $errorModal
            .removeClass("hidden")
            .css("opacity", 0)
            .animate({ opacity: 1 }, 200);
          // Tambahkan efek zoom in pada konten modal
          $errorModal.children().removeClass("scale-95").addClass("scale-100");
        }

        // Fungsi untuk menyembunyikan modal
        function hideModalError() {
          $errorModal.animate({ opacity: 0 }, 200, function () {
            $(this).addClass("hidden");
            // Kembalikan ke scale 95 untuk efek transisi masuk berikutnya
            $(this).children().removeClass("scale-100").addClass("scale-95");
          });
        }

        // Event listener untuk tombol Tutup modal
        $closeModalBtn.on("click", hideModalError);

        // Event listener untuk klik di luar area modal
        $errorModal.on("click", function (e) {
          if (e.target.id === "error-modal") {
            hideModalError();
          }
        });

        // Fungsi untuk mengupdate judul
        function updateOutputTitle(isGenerating) {
          if (isGenerating) {
            $outputTitle.text("Hasil QR Code");
          } else {
            $outputTitle.text("Instruksi");
          }
        }

        function updateNavButtons() {
          const totalCards = resiNumbers.length;

          if (totalCards <= 1) {
            $prevBtn.addClass("hidden");
            $nextBtn.addClass("hidden");
            return;
          }

          $prevBtn.removeClass("hidden");
          $nextBtn.removeClass("hidden");

          $prevBtn.prop("disabled", currentIndex === 0);
          $nextBtn.prop("disabled", currentIndex === totalCards - 1);
        }

        /**
         * Helper untuk membuat nama file dengan format {tahun}-{bulan}-{hari}-{jumlah_resi?}-{waktu}.csv
         */
        function createFilename(count = null) {
          const now = new Date();
          const year = now.getFullYear();
          const month = String(now.getMonth() + 1).padStart(2, "0");
          const day = String(now.getDate()).padStart(2, "0");
          const hours = String(now.getHours()).padStart(2, "0");
          const minutes = String(now.getMinutes()).padStart(2, "0");
          const seconds = String(now.getSeconds()).padStart(2, "0");

          const datePart = `${year}-${month}-${day}`;
          const timePart = `${hours}${minutes}${seconds}`;

          // Jika count ada, gunakan format: {tahun}-{bulan}-{hari}-{jumlah_resi}-{waktu}.csv
          if (count !== null) {
            return `${datePart}-${count}-${timePart}.csv`;
          }
          return `${datePart}-${timePart}.csv`;
        }

        // FUNGSI downloadResiData (DOWNLOAD TUNGGAL) DIHAPUS

        /**
         * FUNGSI: Mengunduh SEMUA data resi dalam satu file CSV.
         * FORMAT ISI CSV: No.,Resi \n 1,{resi1} \n 2,{resi2} ...
         */
        function downloadAllResiCSV(resiArray) {
          if (resiArray.length === 0) {
            showModalError("Tidak ada resi yang dapat diunduh.");
            return;
          }

          try {
            const header = "No.,Resi";
            const csvRows = [header];

            resiArray.forEach((resi, index) => {
              // 1. Sanitization and Quoting (CSV Standard)
              let processedResi = resi.replace(/"/g, '""');
              // Tambahkan petik dua jika mengandung koma, baris baru, atau petik dua
              if (
                processedResi.includes(",") ||
                processedResi.includes("\n") ||
                processedResi.includes('"')
              ) {
                processedResi = `"${processedResi}"`;
              }

              // 2. Format: Index + 1, Resi
              csvRows.push(`${index + 1},${processedResi}`);
            });

            const csvContent = csvRows.join("\n");
            const blob = new Blob([csvContent], {
              type: "text/csv;charset=utf-8;",
            });

            // Define File Name (Menggunakan jumlah resi)
            const fileName = createFilename(resiArray.length);

            // Trigger Download
            const url = URL.createObjectURL(blob);
            const a = document.createElement("a");
            a.href = url;
            a.download = fileName;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);

            console.log(
              `File CSV kolektif (${resiArray.length} resi) berhasil diunduh: ${fileName}`
            );
          } catch (e) {
            console.error("Bulk download failed:", e);
            showModalError(
              "Gagal saat mencoba mengunduh semua file. Periksa konsol untuk detail."
            );
          }
        }

        function renderCard(index) {
          const resi = resiNumbers[index];
          if (!resi) return;

          // Hapus card default jika ada
          $defaultCard.remove();

          // Memastikan hanya ada satu card kontainer dinamis di wrapper
          if (
            $wrapper.children().length === 0 ||
            $wrapper.find("#dynamic-card").length === 0
          ) {
            $wrapper.html(`
                    <!-- Card BG Putih Dipertahankan -->
                    <div id="dynamic-card" class="bg-white p-6 rounded-xl shadow-xl transition duration-300 transform scale-100 hover:shadow-2xl">
                      <!-- Judul Card Warna Disesuaikan ke Orange -->
                      <h3 id="card-title" class="text-xl font-bold text-orange-700 mb-4 truncate text-center"></h3>
                      <div id="${qrcodeId}-container" class="flex justify-center p-3 bg-gray-50 rounded-lg">
                        <div id="${qrcodeId}" class="p-1 border border-gray-200"></div>
                      </div>
                      <p id="card-index" class="text-sm font-semibold text-gray-500 mt-4 text-center"></p>
                      <p class="text-xs text-gray-400 mt-1 text-center">Data: <span id="card-data" class="font-mono text-gray-600"></span></p>
                    </div>
                `);
          }

          // Perbarui konten card
          $("#card-title").text(`Resi: ${resi}`).attr("title", resi);
          $("#card-data").text(resi);
          $("#card-index").text(`Kode ${index + 1} dari ${resiNumbers.length}`);

          $(`#${qrcodeId}`).empty();
          try {
            new QRCode(document.getElementById(qrcodeId), {
              text: resi,
              width: 200, // Ukuran QR code sedikit lebih besar
              height: 200, // Ukuran QR code sedikit lebih besar
              colorDark: "#1f2937",
              colorLight: "#ffffff",
              correctLevel: QRCode.CorrectLevel.H,
            });
          } catch (e) {
            console.error("Error generating QR code:", resi, e);
            $(`#${qrcodeId}`).html(
              '<p class="text-red-500">Gagal membuat QR Code.</p>'
            );
          }

          updateNavButtons();
        }

        function navigateSlider(direction) {
          const totalCards = resiNumbers.length;
          if (totalCards <= 1) return;

          let newIndex = currentIndex;
          if (direction === "next") {
            newIndex = Math.min(currentIndex + 1, totalCards - 1);
          } else {
            // 'prev'
            newIndex = Math.max(currentIndex - 1, 0);
          }

          if (newIndex !== currentIndex) {
            currentIndex = newIndex;
            // Gunakan animasi transisi ringan saat mengganti card
            $("#dynamic-card")
              .removeClass("scale-100")
              .addClass("scale-95 opacity-50");
            setTimeout(() => {
              renderCard(currentIndex);
              $("#dynamic-card")
                .removeClass("scale-95 opacity-50")
                .addClass("scale-100");
            }, 150); // Delay untuk efek transisi
          }
        }

        /**
         * Function utama untuk memproses input dan memulai rendering.
         */
        function generateQRCodes() {
          const rawInput = $input.val().trim();

          // Batasi maksimal 1000 resi
          resiNumbers = rawInput
            .split(/[\n,;]+/) // Mengizinkan baris baru, koma, atau titik koma
            .map((resi) => resi.trim()) // Bersihkan
            .filter((resi) => resi.length > 0)
            .slice(0, 1000);

          if (resiNumbers.length === 0) {
            // Tampilkan modal error ketika resi kosong
            showModalError(
              "Mohon masukkan setidaknya satu nomor resi yang valid."
            );

            // Sembunyikan tombol download all
            $downloadAllBtn.addClass("hidden");

            // Revert title to instruction
            updateOutputTitle(false);
            // Jika tidak ada resi, kembalikan ke tampilan default
            if ($wrapper.find("#default-instruction-card").length === 0) {
              $wrapper.empty().append($defaultCard);
            }
            updateNavButtons();
            return;
          }

          // Pastikan modal error tersembunyi jika ada input
          hideModalError();

          // Tampilkan tombol download all setelah generate berhasil
          $downloadAllBtn.removeClass("hidden");

          // Update title to result
          updateOutputTitle(true);

          currentIndex = 0;
          renderCard(currentIndex);
        }

        // Event listener for the button click (generator)
        $generateBtn.on("click", generateQRCodes);

        // Event listener untuk unduh semua resi
        $downloadAllBtn.on("click", () => downloadAllResiCSV(resiNumbers));

        // Event listeners for navigation
        $prevBtn.on("click", () => navigateSlider("prev"));
        $nextBtn.on("click", () => navigateSlider("next"));

        // Event listener for keyboard navigation (arrows)
        $(document).on("keydown", function (e) {
          // Hanya navigasi jika input tidak sedang fokus dan modal tidak aktif
          if (
            resiNumbers.length > 1 &&
            !$input.is(":focus") &&
            $errorModal.hasClass("hidden")
          ) {
            if (e.key === "ArrowRight") {
              e.preventDefault(); // Mencegah scrolling
              navigateSlider("next");
            } else if (e.key === "ArrowLeft") {
              e.preventDefault(); // Mencegah scrolling
              navigateSlider("prev");
            }
          }
          // Menutup modal dengan tombol ESC
          if (e.key === "Escape" && !$errorModal.hasClass("hidden")) {
            hideModalError();
          }
        });

        // Event listener untuk Enter di textarea (hanya memicu generate, bukan baris baru)
        // $input.on("keypress", function (e) {
        //   if (e.which === 13 && !e.shiftKey) {
        //     e.preventDefault();
        //     generateQRCodes();
        //   }
        // });

        // Initial setup on load to ensure navigation buttons are hidden until needed
        updateNavButtons();

        // Set initial title on load (INI PENTING)
        updateOutputTitle(false);
      });
    </script>
  </body>
</html>
